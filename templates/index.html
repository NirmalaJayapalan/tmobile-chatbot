<!DOCTYPE html>
<html>
<head>
    <title>T-Mobile Chatbot</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        #chatbox { width: 100%; height: 400px; border: 1px solid #ccc; overflow-y: scroll; padding: 10px; }
        input { width: 80%; padding: 10px; }
        button { padding: 10px; }
        .user { color: blue; }
        .bot { color: green; }
        .message { margin-bottom: 10px; }
    </style>
</head>
<body>
    <h2>T-Mobile Chatbot</h2>
    <div id="chatbox"></div>
    <input type="text" id="query" placeholder="Ask me about devices, plans, or promotions">
    <button onclick="sendQuery()">Send</button>

    <script>
        function addMessage(sender, text) {
            const chatbox = document.getElementById("chatbox");
            const div = document.createElement("div");
            div.className = "message " + sender;
            div.innerHTML = `<b>${sender}:</b> ${text}`;
            chatbox.appendChild(div);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        function sendQuery() {
            const input = document.getElementById("query");
            const query = input.value;
            if (!query) return;
            addMessage("User", query);
            input.value = "";

            fetch("/ask", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({query: query})
            })
            .then(res => res.json())
            .then(data => {
                let response = "";
                if (data.devices.length > 0) {
                    response += "<b>Devices:</b><br>";
                    data.devices.forEach(d => {
                        response += `${d.model} - $${d.price} (${d.type})<br>`;
                    });
                }
                if (data.plans.length > 0) {
                    response += "<b>Plans:</b><br>";
                    data.plans.forEach(p => {
                        response += `${p.name} - $${p.price_per_month}/month<br>`;
                    });
                }
                if (data.promotions.length > 0) {
                    response += "<b>Promotions:</b><br>";
                    data.promotions.forEach(p => { response += `${p.description}<br>`; });
                }
                if (!response) response = "Sorry, no matching results found.";
                addMessage("Bot", response);
            });
        }
    </script>
</body>
</html>
